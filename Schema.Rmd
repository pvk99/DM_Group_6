---
title: "Group6_IB9HP0"
output: html_document
date: "2024-02-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())
library(readr)
library(RSQLite)
library(dplyr)
```
## Creating a connection to a database

```{r connect}
my_db <- RSQLite::dbConnect(RSQLite::SQLite(),"ecommerce.db")
```


## SQL Database Schema Creation

### ADS
```{sql connection = my_db}
CREATE TABLE ADS(
  AD_ID VARCHAR(30) PRIMARY KEY,
  PLATFORM VARCHAR(255),
  AD_TITLE VARCHAR(255),
  AD_TYPE VARCHAR(70),
  AD_START_DATE DATE,
  AD_END_DATE DATE,
  COST_PER_CLICK FLOAT,
  CLICK_THROUGH_RATE FLOAT,
  NUMBER_OF_CLICKS FLOAT
);
```

### PROMOTION
```{sql connection = my_db}
CREATE TABLE PROMOTION (
  PROMOTION_ID VARCHAR(30) PRIMARY KEY,
  PROMOTION_VALUE FLOAT,
  PROMOTION_START_DATE DATE,
  PROMOTION_END_DATE DATE,
  MINIMUM_PURCHASE_AMOUNT FLOAT
);
```


### CATEGORY
```{sql connection = my_db}
CREATE TABLE CATEGORY(
  CATEGORY_ID VARCHAR(30) PRIMARY KEY,
  CATEGORY_NAME TEXT NOT NULL,
  GENDER TEXT,
  AGE_GROUP VARCHAR(30)
);
```

### SUPPLIER
```{sql connection = my_db}
CREATE TABLE SUPPLIER (
    SUPPLER_ID VARCHAR(30) PRIMARY KEY,
    SUPPLIER_NAME VARCHAR(50),
    SUPPLIER_PHONE NUMERIC(10),
    SUPPLIER_POSTCODE VARCHAR(30),
    SUPPLIER_EMAIL VARCHAR(30)
);
```

### CUSTOMERS
```{sql connection=my_db}
CREATE TABLE IF NOT EXISTS CUSTOMERS(
  CUSTOMER_ID VARCHAR(30) PRIMARY KEY,
  AD_ID VARCHAR(30),
  EMAIL_ADDRESS VARCHAR(30),
  PHONE_NUMBER NUMERIC(10),
  CUSTOMER_NAME VARCHAR(30),
  CUSTOMER_GENDER TEXT,
  DATE_OF_BIRTH DATE,
  HOUSE_NUMBER VARCHAR(30),
  POSTCODE VARCHAR(30),
  FOREIGN KEY (AD_ID) REFERENCES ADS (AD_ID)
);
```

### PRODUCT
```{sql connection=my_db}
CREATE TABLE IF NOT EXISTS SKU(
    PRODUCT_ID VARCHAR(30) PRIMARY KEY,
    SUPPLIER_ID VARCHAR(30),
    CATEGORY_ID VARCHAR(30),
    COLOR TEXT,
    UNIT_WEIGHT FLOAT,
    PRODUCT_SELLING_PRICE FLOAT,
    PRODUCT_PURCHASING_PRICE FLOAT,
    BRAND TEXT,
    FOREIGN KEY (SUPPLIER_ID) REFERENCES SUPPLIER(SUPPLIER_ID),
    FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY(CATEGORY_ID)
);
```

### TRANSACTION
```{sql connection=my_db}
CREATE TABLE TRANSACTIONS(
  TRANSACTION_ID VARCHAR(30) PRIMARY KEY,
  TRANSACTION_VALUE FLOAT,
  PAYMENT_METHOD VARCHAR(50),
  TRANSACTION_STATUS VARCHAR(50)
);
```


### ORDERS
```{sql connection=my_db}
CREATE TABLE ORDERS (
  ORDER_ID VARCHAR(30) PRIMARY KEY,
  PRODUCT_ID VARCHAR(30),
  CUSTOMER_ID VARCHAR(30),
  TRANSACTION_ID VARCHAR(30),
  ORDER_QUANTITY INTEGER,
  ORDER_DATE DATE,
  ORDER_STATUS TEXT,
  FOREIGN KEY (PRODUCT_ID) REFERENCES SKU(PRODUCT_ID),
  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(CUSTOMER_ID),
  FOREIGN KEY (TRANSACTION_ID) REFERENCES TRANSACTIONS(TRANSACTION_ID)
);
```


### RETURNS

```{sql connection=my_db}
CREATE TABLE RETURNS(
  RETURN_ID VARCHAR(30) PRIMARY KEY,
  PRODUCT_ID VARCHAR(30),
  CUSTOMER_ID VARCHAR(30),
  RETURN_QUANTITY NUMERIC,
  RETURN_DATE DATE,
  RETURN_STATUS TEXT,
  FOREIGN KEY (PRODUCT_ID) REFERENCES SKU(PRODUCT_ID),
  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(CUSTOMER_ID)
);
```







## Synthetic Data Generation
### Create CATEGORY entity
```{r}
# Define categories, genders, and age groups

CATEGORY_ID <- 10001:10080

# Generate all combinations
CATEGORY <- expand.grid(CATEGORY_NAME, GENDER, AGE_GROUP)
CATEGORY$CATEGORY_ID <- CATEGORY_ID

# Rename columns
names(CATEGORY) <- c("CATEGORY_NAME", "GENDER", "AGE_GROUP", "CATEGORY_ID")

# Remove unrealistic cases
CATEGORY <- CATEGORY[!(CATEGORY$CATEGORY_NAME == 'Dress' & CATEGORY$GENDER == 'Male'), ]

  
```

### Create SKU table
```{r}
## Define colors, size, gender, age groups,
colors <- c("black", "white", "blue", "gray", "navy", "red", "green", "brown", "beige", "pink", "purple", "yellow", "orange", "burgundy", "teal")
sizes <- c("XS", "S", "M", "L", "XL")
genders <- c("Male", "Female")
age_groups <- c("Kids", "Pre-Teens", "Young Adults", "Adults")

# Create a dataframe to store all combinations
combinations <- expand.grid(colors = colors,
                            size = sizes,
                            gender = genders,
                            age_group = age_groups,
                            stringsAsFactors = FALSE)

# Define product names for each category
product_names <- list(
  Shirts = c("T-shirt", "Polo shirt", "Button-up shirt", "Blouse", "Sweater"),
  Innerwear = c("Underwear", "Bra"),
  Activewear = c("Hoodie", "Track pants", "Sports tights", "Running shorts"),
  Shoes = c("Sneakers", "Boots", "Sandals"),
  Jackets = c("Coat", "Denim Jacket", "Leather Jacket", "Puffer Jacket"),
  Accessories = c("Gloves", "Necklaces", "Scarf", "Hat", "Ring"),
  Thermals = c("Thermal top", "Thermal bottoms"),
  Pants = c("Joggers", "Cargo Pants", "Chinos", "Sweatpants"),
  Jeans = c("Skinny Jeans", "Straight Leg Jeans", "Flare Jeans"),
  Dress = c("Summer Dress", "Spring Dress", "Winter Dress", "Cocktail Dress")
)

# Create a list to store SKU data
sku_list <- list()

# Iterate over each category and combine with combinations dataframe
for (category in names(product_names)) {
  product_df <- expand.grid(PRODUCT_NAME = product_names[[category]], stringsAsFactors = FALSE)
  product_df$CATEGORY <- category
  sku_list[[category]] <- merge(combinations, product_df, by = NULL)
}

# Combine all SKU dataframes into one dataframe
SKU <- do.call(rbind, sku_list)

# Rename columns
names(SKU) <- c("COLOR", "SIZE", "GENDER", "AGE_GROUP", "PRODUCT_NAME", "CATEGORY")

# Remove unrealistic cases
SKU <- SKU[!(SKU$CATEGORY == 'Dress' & SKU$GENDER == 'Male'), ]
SKU <- SKU[!(SKU$PRODUCT_NAME == 'Bra' & SKU$GENDER == 'Male'), ]

# Add SKU_ID column
SKU$SKU_ID <- paste0("SKU", seq_len(nrow(SKU)) + 10000)

# Add selling and purchasing price
SKU$PRODUCT_PURCHASING_PRICE <- round(runif(nrow(SKU),min=20,max=100),2)
SKU$PRODUCT_PURCHASING_PRICE[SKU$CATEGORY == "Accessories"] <- round(runif(sum(SKU$CATEGORY == "Accessories"), min = 5, max = 20), 2)
markup <- runif(nrow(SKU), min = 0.1, max = 0.3)
SKU$PRODUCT_SELLING_PRICE <- round(SKU$PRODUCT_PURCHASING_PRICE *(1 + markup), 2)

# Add SUPPLIER_ID
SKU$SUPPLIER_ID <- sample(SUPPLIER$SUPPLIER_ID, size = nrow(SKU), replace = TRUE)

```


## Data Import and Quality Assurance

